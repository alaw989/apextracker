---
phase: 02-visual-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/backgrounds.js
  - src/components/visual/AppBackground.vue
  - src/App.vue
  - public/backgrounds/ (legend background images)
autonomous: false

must_haves:
  truths:
    - "Background changes dynamically based on player's favorite legend"
    - "Background crossfades smoothly when searching for a new player"
    - "Default background displays when no player data is available"
  artifacts:
    - path: "src/utils/backgrounds.js"
      provides: "Legend name to background image mapping"
      exports: ["getBackgroundForLegend"]
    - path: "src/components/visual/AppBackground.vue"
      provides: "Background component with Vue Transition crossfade"
      contains: "Transition, mode=\"out-in\""
    - path: "src/App.vue"
      provides: "AppBackground component integration"
      contains: "AppBackground"
  key_links:
    - from: "src/App.vue"
      to: "src/components/visual/AppBackground.vue"
      via: "component import and render"
      pattern: "import.*AppBackground"
    - from: "src/components/visual/AppBackground.vue"
      to: "src/utils/backgrounds.js"
      via: "getBackgroundForLegend function"
      pattern: "getBackgroundForLegend"
---

<objective>
Create a dynamic background system that changes the app background based on the player's favorite legend (top legend by kills).

Purpose: Visual immersion - each legend has a unique themed background that creates a more engaging experience.
Output: Working background component with smooth crossfade transitions when switching between players.
</objective>

<execution_context>
@/home/deck/.claude/get-shit-done/workflows/execute-plan.md
@/home/deck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/REQUIREMENTS.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-visual-polish/02-RESEARCH.md

# Phase 1 Context
@.planning/phases/01-core-lookup/01-01-SUMMARY.md
@.planning/phases/01-core-lookup/01-04-SUMMARY.md
@.planning/phases/01-core-lookup/01-05-SUMMARY.md

# Existing patterns
@src/App.vue
@src/stores/player.js
@src/style/_variables.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create legend background mapping utility</name>
  <files>src/utils/backgrounds.js</files>
  <action>
Create a utility that maps legend names to background image paths.

Implementation requirements:
1. Export a function `getBackgroundForLegend(legendName)` that returns a background image path
2. Handle case-insensitive matching (e.g., "Wraith", "wraith", "WRAITH" all work)
3. Return a default background when legend name is not recognized or no data available
4. Map common Apex legends to background images (store in public/backgrounds/ directory)

Legend mappings to support (minimum):
- Wraith, Pathfinder, Octane, Bloodhound, Gibraltar, Lifeline, Mirage, Bangalore, Caustic, Wattson, Crypto

Default: Return a generic Apex-themed background or a dark gradient

DO NOT use external CDN URLs - store background images locally in public/backgrounds/
  </action>
  <verify>
File exists at src/utils/backgrounds.js with:
- getBackgroundForLegend function exported
- Handles case-insensitive legend names
- Returns default background for unknown legends
  </verify>
  <done>
Calling getBackgroundForLegend("wraith") returns a valid image path
Calling getBackgroundForLegend("Unknown") returns default background path
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AppBackground component with Vue Transition</name>
  <files>src/components/visual/AppBackground.vue</files>
  <action>
Create a background component using Vue's `<Transition>` component for smooth crossfade effects.

Implementation requirements (from 02-RESEARCH.md):
1. Use `<Transition name="bg-fade" mode="out-in">` for sequential crossfade
2. Track background changes with a reactive key that increments when legend changes
3. Apply background image via inline style: `backgroundImage: url(${currentBg})`
4. Add a dark overlay gradient for text readability

CSS requirements (bg-fade transition):
- .bg-fade-enter-active, .bg-fade-leave-active: transition opacity 0.6s ease-in-out
- .bg-fade-enter-from, .bg-fade-leave-to: opacity 0
- .app-background: fixed position, inset 0, z-index -1
- .app-background__overlay: linear-gradient from rgba(15,23,42,0.85) to rgba(15,23,42,0.95)

Props:
- favoriteLegend: Object with { name } or null

Computed behavior:
- Watch favoriteLegend.name changes
- Call getBackgroundForLegend() to get image path
- Increment backgroundKey to trigger transition

DO NOT animate background-image directly (CSS doesn't support it) - use the two-layer crossfade pattern from RESEARCH.md
  </action>
  <verify>
Component exists at src/components/visual/AppBackground.vue with:
- Transition component with mode="out-in"
- Watch on favoriteLegend.name
- CSS classes for bg-fade-enter/leave states
- Fixed positioning with z-index -1
  </verify>
  <done>
AppBackground component renders with fixed positioning
Background changes trigger smooth opacity crossfade (not snap)
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate AppBackground in App.vue</name>
  <files>src/App.vue</files>
  <action>
Add the AppBackground component to the main app and wire it to player data.

Changes to src/App.vue:
1. Import AppBackground component
2. Add computed property for favoriteLegend from data.value.legends[0]
3. Render AppBackground at the top of template (before .app container)
4. Pass favoriteLegend prop: `:favorite-legend="favoriteLegend"`

The favorite legend is the first legend in the legends array (index 0), which is already sorted by kills from Phase 1.

App.vue structure after changes:
```vue
<template>
  <AppBackground :favorite-legend="favoriteLegend" />
  <div class="app">
    <!-- existing content -->
  </div>
</template>
```
  </action>
  <verify>
App.vue contains:
- AppBackground component import
- AppBackground rendered in template with :favorite-legend prop
- favoriteLegend computed property derived from data.value.legends[0]
  </verify>
  <done>
AppBackground renders when app loads
Background updates when searching for different players with different favorite legends
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete dynamic background system with legend-themed backgrounds</what-built>
  <how-to-verify>
1. Start dev server: npm run dev
2. Search for a player with a known favorite legend (e.g., a player whose top legend is Wraith)
3. Verify the background shows an appropriate themed image
4. Search for a different player with a different favorite legend
5. Verify the background crossfades smoothly (not instant snap)
6. Verify the dark overlay makes text readable against the background
7. Search for a player with an unknown/unsupported legend
8. Verify the default background displays correctly

Expected behavior:
- Background image changes based on favorite legend
- Smooth 0.6s crossfade transition between backgrounds
- Default background shows for unknown legends
- Text remains readable with overlay
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues with background behavior</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:
1. Background image changes when searching for players with different favorite legends
2. Crossfade transition is smooth (0.6s duration as specified in CSS)
3. Default background displays for unknown legends or when no player data
4. App continues to function normally (no regressions to search/display)
5. Background doesn't interfere with text readability (dark overlay present)
</verification>

<success_criteria>
1. Searching for a player updates the background to their favorite legend's themed image
2. Background crossfades smoothly when switching between players
3. Default background displays for unknown legends or before any search
4. All Phase 1 functionality remains working (no regressions)
5. Visual polish adds to the experience without breaking core features
</success_criteria>

<output>
After completion, create `.planning/phases/02-visual-polish/02-01-SUMMARY.md`
</output>
