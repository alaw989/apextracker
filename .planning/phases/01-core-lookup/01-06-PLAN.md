---
phase: 01-core-lookup
plan: 06
type: execute
wave: 3
depends_on: ["01-03", "01-04", "01-05"]
files_modified:
  - src/components/ui/LoadingSpinner.vue
  - src/components/ui/ErrorMessage.vue
  - src/App.vue
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Loading spinner shows when search is in progress"
    - "Error message displays when player is not found"
    - "Empty state exists before any search is performed"
    - "Loading state overlays or replaces content area"
    - "Error message is helpful and suggests what to do"
  artifacts:
    - path: "src/components/ui/LoadingSpinner.vue"
      provides: "Loading indicator component"
      min_lines: 30
    - path: "src/components/ui/ErrorMessage.vue"
      provides: "Error display component"
      min_lines: 30
    - path: "src/App.vue"
      provides: "Main app with loading and error states"
      contains: "LoadingSpinner, ErrorMessage"
  key_links:
    - from: "src/App.vue"
      to: "src/stores/player.js"
      via: "storeToRefs for loading, error"
      pattern: "searchLoading|error"
    - from: "src/App.vue"
      to: "src/stores/ui.js"
      via: "useUiStore for hasError, showLoading"
      pattern: "useUiStore"
---

<objective>
Add loading and error states for the search and display flow.

Purpose: Provide feedback during API calls and when searches fail. Users need to know when data is loading and receive helpful error messages for invalid searches. These states complete the user experience for the core lookup feature.

Output: Loading spinner during search, error messages for failed searches, and proper state management throughout the flow.
</objective>

<execution_context>
@/home/deck/.claude/get-shit-done/workflows/execute-plan.md
@/home/deck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-lookup/01-CONTEXT.md
@.planning/phases/01-core-lookup/01-RESEARCH.md
@src/components/Error.js
@src/components/SearchButton.js
</context>

<tasks>

<task type="auto">
  <name>Create LoadingSpinner component</name>
  <files>src/components/ui/LoadingSpinner.vue</files>
  <action>
    Create src/components/ui/LoadingSpinner.vue:

    Props:
    - size: 'small' | 'medium' | 'large' = 'medium'
    - text: string = '' (optional text below spinner)

    Template:
    - Spinner element (CSS-only animation)
    - Optional text label below spinner

    Script:
    - Simple presentation component

    Scoped styles:
    - CSS animation for rotation (0.8s linear infinite)
    - Circle with border and transparent top
    - Size variants: small (16px), medium (32px), large (48px)
    - Centered flex layout
    - Text (if provided): muted color, below spinner

    Spinner CSS from RESEARCH.md:
    ```css
    .spinner-circle {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--accent-primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    ```

    Reference existing loading from src/components/SearchButton.js.
  </action>
  <verify>
    1. Add LoadingSpinner to App.vue
    2. Verify spinner rotates smoothly
    3. Test different size props
    4. Test with and without text prop
  </verify>
  <done>
    LoadingSpinner renders rotating circle with size variants and optional text
  </done>
</task>

<task type="auto">
  <name>Create ErrorMessage component</name>
  <files>src/components/ui/ErrorMessage.vue</files>
  <action>
    Create src/components/ui/ErrorMessage.vue:

    Props:
    - message: string (the error text to display)
    - type: 'error' | 'warning' | 'info' = 'error'

    Template:
    - Icon or symbol indicating error type
    - Error message text
    - Optional dismiss button

    Script:
    - Handle dismiss if dismissible prop is true
    - Emit 'dismiss' event

    Scoped styles:
    - Background: dark with red border for error type
    - Text: white/light
    - Icon: red accent color
    - Rounded corners, padding
    - Centered or full-width depending on usage
    - Type variants: error (red), warning (yellow), info (blue)

    Match existing Error component from src/components/Error.js:
    - Red/dark styling
    - "Sorry. Player nickname does not exist..." message
    - Overlay or inline display
  </action>
  <verify>
    1. Add ErrorMessage to App.vue with test message
    2. Verify error styling (red border, dark background)
    3. Test different type props
    4. Check dismiss functionality if implemented
  </verify>
  <done>
    ErrorMessage displays error message with appropriate styling
  </done>
</task>

<task type="auto">
  <name>Integrate loading and error states in App.vue</name>
  <files>src/App.vue</files>
  <action>
    Update src/App.vue with complete state handling:

    1. Import LoadingSpinner and ErrorMessage

    2. Connect to store states:
       - From player store: searchLoading, data, error
       - Use storeToRefs for reactive state
       - No need for ui store (player store handles these states)

    3. Update SearchButton:
       - Bind :loading="searchLoading"
       - Button should show spinner during search

    4. Add conditional rendering in template:
       Order of conditions:
       a. v-if="searchLoading" - Show loading state
          - Large LoadingSpinner with "Searching..." text
          - Center in content area
       b. v-else-if="error" - Show error state
          - ErrorMessage with error text
          - Below search form
       c. v-else-if="data" - Show player display
          - PlayerHeader, StatsList, FavoriteLegends
       d. v-else - Empty/initial state
          - Just search form, no data yet

    5. Error handling:
       - Error message should be helpful
       - Include suggestion to check username and platform
       - Allow user to try again immediately

    6. Loading behavior:
       - Search button shows mini spinner during fetch
       - Content area shows large spinner while loading
       - Both use searchLoading state for sync

    Reference existing app's error handling from src/App.js lines 127-131 and Error component.

    State flow:
    - Initial: search form only
    - Searching: loading spinner, form disabled
    - Success: player data displays
    - Error: error message, form enabled for retry
  </action>
  <verify>
    1. Run dev server
    2. Test loading state: search and verify spinner shows
    3. Test error state: search for invalid player
    4. Verify error message displays correctly
    5. Test success state: search for valid player
    6. Test retry: search again after error
    7. Verify all states transition correctly
  </verify>
  <done>
    App shows loading spinner during search, error message for invalid players, player data for successful searches
  </done>
</task>

<task type="auto">
  <name>Add search history integration</name>
  <files>src/App.vue</files>
  <action>
    Integrate search history from useSearchStore:

    1. Import useSearchStore
    2. After successful player fetch:
       - Call searchStore.addToHistory(username, platform)
       - This stores recent searches for quick re-access

    3. Optional: Show recent searches dropdown (Claude's discretion):
       - If user focuses input and has history
       - Show list of recent searches below input
       - Clicking a search item triggers that search

    Note: CONTEXT.md specified "Search history persisted" as a requirement.
    Full search history UI can be deferred, but the storage should work.

    Keep this simple:
    - Just store the history after successful search
    - Don't build full UI (can be added later if needed)
  </action>
  <verify>
    1. Search for a player
    2. Check localStorage for 'apex-search-history' key
    3. Verify search was added to history
    4. Search again and verify history updates
  </verify>
  <done>
    Search history is stored in localStorage after each successful search
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify:
- [ ] LoadingSpinner component exists with size variants
- [ ] ErrorMessage component exists with type variants
- [ ] Search button shows loading state during fetch
- [ ] Content area shows loading spinner during fetch
- [ ] Error message displays for invalid player searches
- [ ] Successful searches display player data
- [ ] States transition correctly (initial → loading → success/error)
- [ ] Search history is stored in localStorage
</verification>

<success_criteria>
1. Loading spinner displays during API fetch
2. Error message shows helpful text for invalid searches
3. Search button is disabled during loading
4. States transition smoothly: initial → loading → result
5. Search history persists across sessions
6. User can retry search immediately after error
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-lookup/01-06-SUMMARY.md`
</output>
